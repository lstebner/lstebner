var Generators,MathGenerator,_,extend=function(e,n){function t(){this.constructor=e}for(var o in n)hasProp.call(n,o)&&(e[o]=n[o]);return t.prototype=n.prototype,e.prototype=new t,e.__super__=n.prototype,e},hasProp={}.hasOwnProperty;_=require("underscore"),MathGenerator=function(){function MathGenerator(e){this.opts=null!=e?e:{},this.generate(!0)}return MathGenerator.generate=function(e,n,t){var o,r;return null==n&&(n={}),null==t&&(t=!1),r=function(){switch(e){case"addition_basic":return n.upper_limit=20,Generators.AdditionBasic;case"addition_intermediate":return Generators.AdditionBasic;case"subtraction_basic":return n.upper_limit=25,Generators.SubtractionBasic;case"multiplication":return Generators.Multiplication;case"addition_long":return Generators.AdditionLong;case"addition_variable":return n.insert_var=!0,Generators.AdditionBasic;case"multiplication_variable":return n.insert_var=!0,Generators.Multiplication;case"multiplication_doubles":return n.doubles=!0,n.upper_limit=20,n.num_questions=12,Generators.Multiplication;case"addition_chain":return null;default:return MathGenerator}}(),o=new r(n),t?o:o.questions},MathGenerator.prototype.generate=function(force){var ans,choices_pool,exp,highest_num,i,j,l,len,lowest_num,m,n,new_choice,num1,num2,num_choices,num_questions,op,q,question,questions,ref,ref1,ref2,ref3;if(null==force&&(force=!1),null!=this.questions&&!force)return this.questions;for(questions=[],choices_pool=[],lowest_num=this.opts.lowest_num||0,highest_num=this.opts.highest_num||26,num_questions=this.opts.num_questions||26,num_choices=this.opts.num_choices||4,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)num1=Math.floor(Math.random()*(highest_num-lowest_num)+lowest_num),num2=Math.floor(Math.random()*(highest_num-lowest_num)+lowest_num),op=6*Math.random()>2?"+":"-",exp=""+num1+op+num2,ans=eval(exp),question=exp+"=?",choices_pool.push(ans),questions.push({question:question,answer:ans,choices:[ans]});for(i=l=ref1=-highest_num,ref2=2*highest_num;ref2>=ref1?ref2>l:l>ref2;i=ref2>=ref1?++l:--l)choices_pool.push(i);for(m=0,len=questions.length;len>m;m++){for(q=questions[m],i=n=0,ref3=num_choices-1;ref3>=0?ref3>n:n>ref3;i=ref3>=0?++n:--n){for(new_choice=choices_pool[Math.floor(Math.random()*choices_pool.length)];_.indexOf(q.choices,new_choice)>-1;)new_choice=choices_pool[Math.floor(Math.random()*choices_pool.length)];q.choices.push(new_choice)}q.choices.sort(function(e){return 6*Math.random()>3?1:-1}),q.choices.sort(function(e){return 9*Math.random()>3?1:-1})}return this.questions=questions},MathGenerator}(),Generators={},Generators.AdditionBasic=function(superClass){function AdditionBasic(){return AdditionBasic.__super__.constructor.apply(this,arguments)}return extend(AdditionBasic,superClass),AdditionBasic.prototype.generate=function(force){var ans,char,exp,i,j,lower_limit,num1,num2,num_questions,question,questions,ref,upper_limit;for(null==force&&(force=!1),questions=[],num_questions=this.opts.num_questions||26,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)this.opts.insert_var?upper_limit=lower_limit=this.opts.lower_limit||25:(lower_limit=this.opts.lower_limit||10,upper_limit=this.opts.upper_limit||50),num1=Math.floor(Math.random()*lower_limit),num2=Math.floor(Math.random()*upper_limit),exp=num1+" + "+num2,ans=eval(exp),this.opts.insert_var?(char="xyzna".charAt(Math.floor(5*Math.random())),exp=exp.replace("+ "+num2,"+ "+char),question=exp+" = "+ans+"; "+char+" ="):question=exp.replace("*","x")+" =",questions.push({question:question,answer:ans,variable:this.opts.insert_var?char:!1});return this.questions=questions},AdditionBasic}(MathGenerator),Generators.SubtractionBasic=function(superClass){function SubtractionBasic(){return SubtractionBasic.__super__.constructor.apply(this,arguments)}return extend(SubtractionBasic,superClass),SubtractionBasic.prototype.generate=function(force){var ans,exp,i,j,num1,num2,num_questions,oldnum1,questions,ref;for(null==force&&(force=!1),questions=[],num_questions=this.opts.num_questions||26,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)num1=Math.floor(Math.random()*(this.opts.upper_limit||50)),num2=Math.floor(Math.random()*(this.opts.lower_limit||10)),num2>num1&&(oldnum1=num1,num1=num2,num2=oldnum1),exp=num1+" - "+num2,ans=eval(exp),questions.push({question:exp+" =",answer:ans});return this.questions=questions},SubtractionBasic}(MathGenerator),Generators.Multiplication=function(superClass){function Multiplication(){return Multiplication.__super__.constructor.apply(this,arguments)}return extend(Multiplication,superClass),Multiplication.prototype.generate=function(force){var ans,char,exp,i,j,num1,num2,num_questions,question,questions,ref;for(null==force&&(force=!1),questions=[],num_questions=this.opts.num_questions||26,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)this.opts.doubles?num2=num1=Math.floor(Math.random()*(this.opts.upper_limit||17)+1):(num1=Math.floor(Math.random()*(this.opts.upper_limit||10)),num2=Math.floor(Math.random()*(this.opts.upper_limit||10)+1)),exp=num1+" * "+num2,ans=eval(exp),this.opts.insert_var?(char="xyzna".charAt(Math.floor(5*Math.random())),exp=exp.replace(" * "+num2,char),question=exp+" = "+ans+"; "+char+" ="):question=exp.replace("*","x")+" =",questions.push({question:question,answer:ans,variable:this.opts.insert_var?char:!1});return this.questions=questions},Multiplication}(MathGenerator),Generators.AdditionLong=function(superClass){function AdditionLong(){return AdditionLong.__super__.constructor.apply(this,arguments)}return extend(AdditionLong,superClass),AdditionLong.prototype.generate=function(force){var ans,exp,i,j,k,num_numbers,num_questions,numbers,questions,ref;for(null==force&&(force=!1),questions=[],num_questions=this.opts.num_questions||26,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)num_numbers=Math.ceil(3*Math.random()+2),numbers=function(){var e,n,t;for(t=[],k=e=0,n=num_numbers;n>=0?n>e:e>n;k=n>=0?++e:--e)t.push(Math.floor(15*Math.random()));return t}(),exp=numbers.join(" + "),ans=eval(exp),questions.push({question:exp+" =",answer:ans});return this.questions=questions},AdditionLong}(MathGenerator),module.exports=MathGenerator;