var MathGenerator,_;_=require("underscore"),module.exports=MathGenerator=function(){function MathGenerator(e){this.opts=null!=e?e:{},this.generate()}return MathGenerator.prototype.generate=function(force){var ans,choices_pool,exp,highest_num,i,j,k,l,len,lowest_num,m,new_choice,num1,num2,num_choices,num_questions,op,q,question,questions,ref,ref1,ref2,ref3;if(null==force&&(force=!1),null!=this.questions&&!force)return this.questions;for(questions=[],choices_pool=[],lowest_num=this.opts.lowest_num||0,highest_num=this.opts.highest_num||30,num_questions=this.opts.num_questions||20,num_choices=this.opts.num_choices||4,i=j=0,ref=num_questions;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)num1=Math.floor(Math.random()*(highest_num-lowest_num)+lowest_num),num2=Math.floor(Math.random()*(highest_num-lowest_num)+lowest_num),op=6*Math.random()>2?"+":"-",exp=""+num1+op+num2,ans=eval(exp),question=exp+"=?",choices_pool.push(ans),questions.push({question:question,answer:ans,choices:[ans]});for(i=k=ref1=-highest_num,ref2=2*highest_num;ref2>=ref1?ref2>k:k>ref2;i=ref2>=ref1?++k:--k)choices_pool.push(i);for(l=0,len=questions.length;len>l;l++){for(q=questions[l],i=m=0,ref3=num_choices-1;ref3>=0?ref3>m:m>ref3;i=ref3>=0?++m:--m){for(new_choice=choices_pool[Math.floor(Math.random()*choices_pool.length)];_.indexOf(q.choices,new_choice)>-1;)new_choice=choices_pool[Math.floor(Math.random()*choices_pool.length)];q.choices.push(new_choice)}q.choices.sort(function(e){return 6*Math.random()>3?1:-1}),q.choices.sort(function(e){return 9*Math.random()>3?1:-1})}return this.questions=questions},MathGenerator}();