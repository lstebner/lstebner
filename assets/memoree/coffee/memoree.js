(function(){var t,e,n,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.dictionary_data={colors:[["red","あか"],["yellow","きいろ"],["black","くろ"],["white","しろ"],["blue","あお"],["purple","むらさき"],["green","みどり"]],foods:[["apple","りんご"],["strawberry","いちご"],["peach","もも"],["banana","バナナ"],["pear","なし"],["watermelon","スイカ"],["lemon","レモン"],["persimmon","カキ"],["pineapple","パイナップル"],["onigiri","おにぎり"],["bento","おべんと"],["sushi","ずし"],["ramen","ラーメン"],["soba","そば"],["udon","うどん"],["cold soba","ざるそば"],["tofu udon","きつねうどん"],["edamame","えだまめ"],["oyaki","おやき"],["okonomiyaki","おこのみやき"]]},e={init:function(){var t;return t=JSON.parse($("#memoree_data").val()),window.dictionary_data=_.extend(window.dictionary_data,t),this.toolbar=new e.Toolbar("#toolbar"),this.memoree=new e.Main("#memoree"),$(document.body).on("memoree:request",function(t){return function(e,n){return t.request(n)}}(this))},request:function(t){if(!(_.indexOf(["reset"],t)>-1))return console.log("requested action is not available");switch(t){case"reset":return this.memoree.reset()}}},e.Main=function(){function t(t,e){this.opts=null!=e?e:{},this.opts=_.extend({shuffle:!0,dictionary:"characters.hiragana",mode:"define",theme:"alt",num_tiles:42},this.opts),this.container=$(t),this.container.addClass(this.opts.theme),this.setup(),this.render()}return t.prototype.setup=function(){return this.uncovered_cards=0,this.matched_cards=0,this.stats={clicks:0,matched:0,remaining:0},this.card_zone=this.container.find(".card_zone"),this.load_deck(),this.setup_events()},t.prototype.setup_events=function(){return this.container.on("click",function(t){return function(e){var n,r,i,s;return i=!0,s=!0,r=$(e.target),n=$(e.currentTarget),r.is(".card")&&t.click_card(r,e),i&&e.preventDefault(),s?void 0:e.stopPropagation()}}(this)),this.container.on("memoree:change_dictionary",function(t){return function(e,n){return t.set_dictionary(n),t.reset()}}(this))},t.prototype.set_dictionary=function(t){var e;if(t!==this.opts.dictionary&&(e=["characters.hiragana","characters.katakana","foods","colors","time","japanese_numbers"],_.indexOf(e,t)>-1))return this.opts.dictionary=t},t.prototype.load_dictionary=function(t){var e,n,r,i,s,o;if(!_.isArray(t)&&_.isString(t)){if(!_.isString(t))return console.log("keys must be a string or array, not a '"+typeof t+"'");t=[t]}for(e=window.dictionary_data,n=[],r=0,s=t.length;s>r;r++)i=t[r],null!=e[i]&&(o=e[i],n=_.union(n,o)),console.log("data",n);return n},t.prototype.load_deck=function(){return this.words=this.load_dictionary(this.opts.dictionary),this.words.length>this.opts.num_tiles/2&&(this.words=_.first(_.shuffle(this.words),this.opts.num_tiles/2)),this.stats.remaining=this.words.length,this.stats_updated()},t.prototype.stats_updated=function(){return this.container.trigger("memoree:stats:update",this.stats)},t.prototype.render=function(){var t,e,n,r,i,s,o,a,c,u,h,d;for(this.cards=[],c=this.words,r=n=0,s=c.length;s>n;r=++n)h=c[r],d=h[0],a="match"===this.opts.mode?d:h[1],t="<div class='card' data-id='"+r+"'><span>"+d+"</span></div>",this.cards.push(t),a="<div class='card' data-id='"+r+"m'><span>"+a+"</span></div>",this.cards.push(a);for(e=this.opts.shuffle?_.shuffle(this.cards):this.cards,u=[],i=0,o=e.length;o>i;i++)t=e[i],u.push(this.card_zone.append(t));return u},t.prototype.click_card=function(t,e){return!this.check_cards_to&&_.isEmpty(_.intersection(t[0].classList,["match","miss","uncover"]))?(this.uncovered_cards<2&&this.uncover(t),2===this.uncovered_cards?this.check_cards_to=setTimeout(function(t){return function(){return t.check_cards_to=null,t.check_uncovered_cards(),t.matched_cards===t.words.length?t.finished():void 0}}(this),500):void 0):void 0},t.prototype.uncover=function(t){return t.addClass("uncover"),this.stats.clicks++,this.stats_updated(),this.uncovered_cards++},t.prototype.check_uncovered_cards=function(){var t,e,n,r,i,s;return t=this.container.find(".card.uncover"),2!==t.length?console.log("not enough uncovered cards"):(r=function(){var r,i,s;for(s=[],r=0,i=t.length;i>r;r++)e=t[r],n=$(e).data("id"),s.push(n);return s}(),i=this.is_match(r[0],r[1]),s=i?(this.matched_cards++,this.stats.matched++,this.stats.remaining--,this.stats_updated(),"match"):(setTimeout(function(t){return function(){return t.container.find(".miss").removeClass("miss")}}(this),1200),"miss"),t.addClass(s).removeClass("uncover"),this.uncovered_cards=0,i)},t.prototype.is_match=function(t,e){return e===t+"m"||t===e+"m"},t.prototype.finished=function(){return console.log("all cards matched!"),this.container.addClass("complete")},t.prototype.reset=function(){return this.uncovered_cards=0,this.matched_cards=0,this.card_zone.html(""),this.container.removeClass("complete"),this.stats={clicks:0,matched:0,remaining:this.words.length},this.stats_updated(),this.load_deck(),this.render()},t}(),e.Toolbar=function(){function t(t,e){this.opts=null!=e?e:{},this.container=$(t),this.setup()}return t.prototype.setup=function(){return this.setup_events()},t.prototype.setup_events=function(){return this.container.on("click",function(t){return function(e){var n,r,i,s;return i=!0,s=!0,r=$(e.target),n=$(e.currentTarget),r.is(".reset_btn")&&confirm("Are you sure?")&&t.container.trigger("memoree:request","reset"),i&&e.preventDefault(),s?void 0:e.stopPropagation()}}(this)),this.container.on("change","select[name=dictionary]",function(t){return function(e){return t.container.trigger("memoree:change_dictionary",$(e.currentTarget).val())}}(this)),$(document.body).on("memoree:stats:update",function(t){return function(e,n){return t.stats=n,t.render_stats()}}(this))},t.prototype.render_stats=function(){var t,e;return t=this.container.find(".stats").html(""),e="clicks: "+this.stats.clicks+"  matched: "+this.stats.matched+"  remaining: "+this.stats.remaining,t.text(e)},t}(),n=function(){function t(t,e){this.opts=null!=e?e:{},this.content=$(t).html(),this.construct(),this.setup_events()}return t.prototype.construct=function(){return this.setup_overlay(),this.container=$("<div class='menu'></div>"),$(document.body).append(this.container),this.container.html(this.content)},t.prototype.setup_overlay=function(){return this.overlay?this.overlay:(this.overlay=$("<div class='overlay'></div>"),$(document.body).append(this.overlay))},t.prototype.setup_events=function(){return this.container.on("click",function(t){return function(t){return t.stopPropagation(),!1}}(this)),this.overlay.on("click",function(t){return function(e){return e.stopPropagation(),t.close()}}(this))},t.prototype.close=function(){return this.overlay.hide(),this.container.hide()},t.prototype.open=function(){return this.overlay.show(),this.container.show()},t}(),t=function(t){function e(t){this.opts=null!=t?t:{},e.__super__.constructor.call(this,"#dictionary_menu_template",this.opts)}return r(e,t),e.prototype.setup_events=function(){return e.__super__.setup_events.apply(this,arguments),this.container.on("click","li",function(t){return function(t){return t.preventDefault(),$(t.currentTarget).toggleClass("selected")}}(this)),this.container.on("click",".submit_btn",function(t){return function(e){return e.preventDefault(),t.apply_dictionary_selections()}}(this))},e.prototype.apply_dictionary_selections=function(){return this.close()},e}(n),document.DictionaryMenu=t,document.Memoree=e,$(function(){return document.Memoree.init()})}).call(this);