(function(){var e,t,r,s,n,i,o,a,c,p,l,u;a=require("http"),n=require("httpdispatcher"),l=require("pug"),c=require("less"),s=require("coffee-script"),r=require("underscore"),i=require("fs"),p=3014,e=function(){function e(e,t){this.root_dir=null!=e?e:""+__dirname,this.res=t}return e.prototype.less_opts={compress:!1,paths:["./assets/less"]},e.prototype.coffee_opts={},e.prototype.serve_stylesheet=function(e){var t;return console.log("AssetServer::stylesheet "+e),e=e.replace(/css/g,"less"),this.res.writeHead("200","Content-Type: text/css"),t=i.readFileSync(""+this.root_dir+e,"UTF-8"),c.render(t,this.less_opts,function(e){return function(t,r){return e.res.end(r.css)}}(this))},e.prototype.serve_coffeescript=function(e){var t;return console.log("AssetServer::coffeescript "+e),e=e.replace(/\.js/,".coffee"),this.res.writeHead("200","Content-Type: text/javascript"),t=i.readFileSync(""+this.root_dir+e,"UTF-8"),this.res.end(s.compile(this.process_replacements(t)))},e.prototype.serve_javascript=function(e){var t;return console.log("AssetServer::javascript "+e),this.res.writeHead("200","Content-Type: text/javascript"),t=i.readFileSync(""+this.root_dir+e,"UTF-8"),this.res.end(t)},e.prototype.serve_image=function(e){return console.log("AssetServer::image "+e),this.res.writeHead("200","Content-Type: text/"+e.substr(e.lastIndexOf("."))),this.res.end(i.readFileSync(""+this.root_dir+e))},e.prototype.process_replacements=function(e){var t,r,s,n,o,a,c,p,l,u,h;if(l=e.match(/#(\s+|)\{\{(prepend|append|insert):([a-zA-Z0-9\-_\/]+)\}\}/g),u={},!l||!l.length)return e;for(o=0,c=l.length;c>o;o++)p=l[o],u.hasOwnProperty(p)||(t=p.match(/(prepend|append|insert):/),r=p.match(/:([a-zA-Z0-9\-_\/]+)/),n=__dirname+"/assets/coffee/"+r[1]+".coffee",s=this.process_replacements(i.readFileSync(n,"UTF-8")),u[p]={action:t[1],file:r[1],contents:s});for(a in u)h=u[a],e=e.replace(new RegExp(a,"g"),h.contents);return e},e}(),t=function(){function e(e,t,r){this.res=t,this.data=null!=r?r:{},this.filename=__dirname+"/views/"+e+".pug"}return e.prototype.write_head=function(e){return this.res.writeHead(""+e,"Content-Type: text/plain")},e.prototype.render=function(){var e;return this.write_head(200),e=l.renderFile(this.filename,this.data),this.res.end(e)},e}(),o=function(t,r){var s,i,o;return console.log("url hit: "+t.url),o=t.url,i=null,s=new e(__dirname+"/assets/",r),o.match(/css\/[a-zA-Z\/]+\.css/)?s.serve_stylesheet(o,r):o.match(/coffee\/[a-zA-Z\/\.\-_0-9]+\.js/)?s.serve_coffeescript(o,r):o.match(/lib\/[a-zA-Z\/\.\-_0-9]+\.js/)?s.serve_javascript(o,r):o.match(/images\/[a-zA-Z\/\.\-_0-9]+\.(jpg|png)/)?s.serve_image(o,r):(n.dispatch(t,r),null==i&&(i="404, whoops"),r.end(i))},n.setStatic("assets"),u=a.createServer(o),n.onGet("/",function(e,r){var s;return s=new t("index",r,{page:"home"}),s.render()}),n.onGet("/beats",function(e,r){var s;return s=new t("beats",r,{page:"beats"}),s.render()}),u.listen(p,function(){return console.log("Server started on port "+p)})}).call(this);